{% extends 'bakery/driver_base.html' %}

{% block title %}Settings - Driver Panel{% endblock %}

{% block extra_css %}
<style>
    .settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .settings-header h1 {
        font-size: 22px;
        font-weight: 800;
    }

    .settings-grid {
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 24px;
    }

    @media (max-width: 1024px) {
        .settings-grid {
            grid-template-columns: 1fr;
        }
    }

    .profile-card {
        text-align: center;
        padding: 32px 24px;
    }

    .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        font-weight: 800;
        margin: 0 auto 16px;
        box-shadow: 0 4px 12px rgba(232, 89, 12, 0.3);
    }

    .profile-name {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .profile-role {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 16px;
    }

    .profile-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 16px;
    }

    .profile-stat {
        padding: 14px;
        border-radius: var(--radius-sm);
        background: var(--bg);
        text-align: center;
    }

    .profile-stat-value {
        font-size: 20px;
        font-weight: 800;
    }

    .profile-stat-label {
        font-size: 11px;
        color: var(--text-secondary);
        margin-top: 2px;
    }

    .availability-toggle {
        padding: 18px 22px;
        margin-top: 16px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .form-group {
        margin-bottom: 18px;
    }

    .form-group label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--text);
    }

    .form-control {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        font-size: 14px;
        font-family: inherit;
        background: var(--card);
        transition: var(--transition);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(232, 89, 12, 0.1);
    }

    .form-control:disabled {
        background: var(--bg);
        color: var(--text-secondary);
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
    }

    @media (max-width: 640px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }

    .form-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .section-title-sm {
        font-size: 14px;
        font-weight: 700;
        margin-bottom: 16px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .section-title-sm i {
        color: var(--primary);
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-row .label {
        color: var(--text-secondary);
    }

    .info-row .value {
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-header">
    <h1>‚öôÔ∏è Settings</h1>
</div>

<div class="settings-grid">
    <!-- LEFT ‚Äî Profile Form -->
    <div>
        <form method="POST" action="{% url 'driver_settings' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_profile">

            <div class="card" style="margin-bottom:20px;">
                <div class="card-header">
                    <span><i class="fas fa-user" style="color:var(--primary);margin-right:8px;"></i> Personal
                        Information</span>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first_name">First Name</label>
                            <input type="text" class="form-control" id="first_name" name="first_name"
                                value="{{ user.first_name }}" placeholder="First name">
                        </div>
                        <div class="form-group">
                            <label for="last_name">Last Name</label>
                            <input type="text" class="form-control" id="last_name" name="last_name"
                                value="{{ user.last_name }}" placeholder="Last name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" class="form-control" id="email" value="{{ user.email }}" disabled>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="text" class="form-control" id="phone" name="phone" value="{{ profile.phone }}"
                            placeholder="+91 XXXXX XXXXX">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="address">Address</label>
                            <input type="text" class="form-control" id="address" name="address"
                                value="{{ profile.address }}" placeholder="Street address">
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" class="form-control" id="city" name="city" value="{{ profile.city }}"
                                placeholder="City">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom:20px;">
                <div class="card-header">
                    <span><i class="fas fa-motorcycle" style="color:var(--primary);margin-right:8px;"></i> Vehicle
                        Information</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="vehicle_number">Vehicle Registration Number</label>
                        <input type="text" class="form-control" id="vehicle_number" name="vehicle_number"
                            value="{{ profile.vehicle_number }}" placeholder="TS 01 XX 1234">
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                <button type="reset" class="btn btn-outline"><i class="fas fa-undo"></i> Reset</button>
            </div>
        </form>
    </div>

    <!-- RIGHT ‚Äî Profile Card + Quick Info -->
    <div>
        <div class="card profile-card" style="margin-bottom:20px;">
            <div class="profile-avatar">{{ user.first_name|first|upper|default:"D" }}</div>
            <div class="profile-name">{{ user.first_name|default:user.username }} {{ user.last_name }}</div>
            <div class="profile-role">
                <span class="badge-status badge-confirmed" style="font-size:12px;">üöö Driver</span>
            </div>

            <div class="availability-toggle">
                <div>
                    <div style="font-weight:600;font-size:14px;">Availability</div>
                    <div style="font-size:12px;color:var(--text-secondary);">
                        {% if profile.is_available %}You're receiving orders{% else %}You're offline{% endif %}
                    </div>
                </div>
                <label style="position:relative;width:50px;height:26px;cursor:pointer;">
                    <input type="checkbox" {% if profile.is_available %}checked{% endif %} style="display:none;"
                        onchange="toggleAvailability()">
                    <span
                        style="position:absolute;inset:0;background:{% if profile.is_available %}var(--success){% else %}#cbd5e1{% endif %};border-radius:13px;transition:0.3s;"
                        id="settingsToggleTrack"></span>
                    <span
                        style="position:absolute;top:3px;left:{% if profile.is_available %}24px{% else %}3px{% endif %};width:20px;height:20px;background:#fff;border-radius:50%;transition:0.3s;box-shadow:0 1px 3px rgba(0,0,0,0.2);"
                        id="settingsToggleKnob"></span>
                </label>
            </div>

            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" style="color:var(--success);">‚Äî</div>
                    <div class="profile-stat-label">Total Deliveries</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" style="color:var(--primary);">‚≠ê 4.8</div>
                    <div class="profile-stat-label">Rating</div>
                </div>
            </div>
        </div>

        <!-- Account Info -->
        <div class="card">
            <div class="card-header">
                <span><i class="fas fa-info-circle" style="color:var(--primary);margin-right:8px;"></i> Account
                    Details</span>
            </div>
            <div class="card-body">
                <div class="info-row">
                    <span class="label">Username</span>
                    <span class="value">{{ user.username }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Email</span>
                    <span class="value">{{ user.email }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Member Since</span>
                    <span class="value">{{ user.date_joined|date:"d M Y" }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Vehicle</span>
                    <span class="value">{{ profile.vehicle_number|default:"Not set" }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Status</span>
                    <span class="value">
                        {% if profile.is_available %}
                        <span style="color:var(--success);"><i class="fas fa-circle" style="font-size:8px;"></i>
                            Online</span>
                        {% else %}
                        <span style="color:#94a3b8;"><i class="fas fa-circle" style="font-size:8px;"></i> Offline</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Sync the settings page toggle with the sidebar toggle
    const origToggle = toggleAvailability;
    toggleAvailability = function () {
        origToggle();
        setTimeout(() => {
            const isOnline = document.getElementById('statusText').textContent === 'Online';
            const track = document.getElementById('settingsToggleTrack');
            const knob = document.getElementById('settingsToggleKnob');
            if (track) track.style.background = isOnline ? 'var(--success)' : '#cbd5e1';
            if (knob) knob.style.left = isOnline ? '24px' : '3px';
        }, 500);
    };
</script>
{% endblock %}